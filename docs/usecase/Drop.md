# Drop

## ユースケース

### 投稿する

投稿画面への動線は未決定

1. ユーザーは、投稿画面にて、投稿したい内容を入力できる(最大は 3000 文字で、後述のMediaの添付がなされている場合のみnullを許容)
2. ユーザーは、投稿画面にて、絵文字パレットを表示しカーソルの位置に挿入することができる
3. ユーザーは、投稿の後悔範囲を`PostScope`の中から選んで設定できる
4. ユーザーは、投稿に CW を付与することができる。最大は 300 文字
5. ユーザーは、投稿にすでにアップロードされている Media を添付することができる。最大数は 4
6. ユーザーは、投稿の有効期限を設定できる(時限投稿)
7. ユーザーは、投稿ボタンを押すことで、mutation.createDrop を発行する
8. バックエンドは、該当するタイムラインの更新通知を行い、該当するユーザー/クライアントに対し、subscription.dropAddedToTimeline を発行する
9. バックエンドは、投稿を DB に格納する

### 投稿を削除する

前提: 自身の投稿|適切なロールがあれば、削除ボタンが表示される

1. ユーザーは、投稿下部にある三点リーダーを押す
2. ユーザーは、削除ボタンを押すことで確認モーダルを表示する
3. ユーザーは、確認モーダルの削除ボタンを押すことで、mutation.deleteDrop を発行する
4. バックエンドは、投稿を DB から削除する
5. バックエンドは、該当するタイムラインの更新通知を行い、該当するユーザー/クライアントに対し、subscription.dropRemovedFromTimeline を発行する

### 時限投稿の効果により、自動で削除される

前提: まだ仕組みは考えている途中

1. バックエンドは、投稿の有効期限が切れた投稿を削除する
2. バックエンドは、フロントエンドに対して、subscription.dropRemovedFromTimeline を発行して削除された投稿の ID を通知する

### 投稿の詳細画面を表示する

前提:

- 詳しい動線は考えていない
- Subscription ですでに保持している内容は利用しない。リアクションが更新されている気がする
- リアクションのリアルタイム更新は行わない
- キャッシュについてはまだ考えてない

1. ユーザーは、投稿の内容を表示するページへ遷移する
2. フロントエンドは、query.drop を発行して投稿の内容を取得する
3. フロントエンドは、取得した情報を画面に表示する
