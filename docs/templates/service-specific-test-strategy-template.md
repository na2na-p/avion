# サービス固有テスト戦略テンプレート

このテンプレートは、各サービスのDesignDocに追加する「サービス固有のテスト戦略」セクションの標準形式です。

---

## X. サービス固有のテスト戦略

このサービスでは、[共通テスト戦略](../common/testing-strategy.md)に加えて、以下のサービス固有のテスト要件を実装します。

### X.1 技術固有のテスト要件

#### X.1.1 特殊な依存関係のモック戦略

```go
// [サービス名]固有のモック設定例
// 例: 外部API、特殊なプロトコル、ハードウェア依存など
```

#### X.1.2 このサービス特有の技術課題

- **課題1**: [具体的な技術課題]
  - テストアプローチ: [解決方法]
  - 実装例: [コード例]

### X.2 ドメイン固有のテストシナリオ

#### X.2.1 クリティカルパステスト（95%カバレッジ必須）

```go
// クリティカルな業務ロジックのテスト例
func TestCriticalBusinessLogic(t *testing.T) {
    tests := []struct {
        name    string
        // サービス固有のテストケース
    }{
        {
            name: "正常系: [具体的なユースケース]",
            // ...
        },
        {
            name: "異常系: [エッジケース]",
            // ...
        },
    }
    // 実装
}
```

#### X.2.2 ドメイン不変条件のテスト

```go
// Aggregateの不変条件テスト
func TestAggregate_Invariants(t *testing.T) {
    // このサービス固有の不変条件検証
}
```

### X.3 統合テストシナリオ

#### X.3.1 依存サービスとの統合

```go
// 依存サービスとの統合テスト
func TestIntegration_DependentService(t *testing.T) {
    // testcontainersまたはモックサーバーを使用
}
```

#### X.3.2 外部システムとの統合

- **統合対象**: [外部システム名]
- **テスト戦略**: [モック/スタブ/実環境]
- **検証項目**: [具体的な検証内容]

### X.4 パフォーマンステスト基準

#### X.4.1 サービス固有のベンチマーク

```go
// このサービス特有のパフォーマンステスト
func BenchmarkServiceSpecificOperation(b *testing.B) {
    // SLA: [具体的な目標値]
    // 例: 99パーセンタイル < 100ms
}
```

#### X.4.2 負荷テストシナリオ

| シナリオ | 同時接続数 | RPS | 成功率目標 | レイテンシ目標 |
|---------|----------|-----|-----------|--------------|
| 通常負荷 | X | Y | 99.9% | p50 < Xms |
| ピーク負荷 | X | Y | 99.5% | p99 < Xms |
| 限界負荷 | X | Y | 99.0% | p99 < Xms |

### X.5 セキュリティテスト

#### X.5.1 このサービス固有のセキュリティ検証

```go
// セキュリティ関連のテスト
func TestSecurity_SpecificVulnerability(t *testing.T) {
    // 例: SQLインジェクション、XSS、認証バイパスなど
}
```

### X.6 エラーハンドリングテスト

#### X.6.1 障害シナリオテスト

```go
// カオステスト/障害注入テスト
func TestChaos_ServiceFailure(t *testing.T) {
    // 依存サービス障害
    // ネットワーク分断
    // リソース枯渇
}
```

### X.7 E2Eテストシナリオ

このサービス固有のE2Eテストシナリオ：

1. **シナリオ1**: [ユーザーストーリー]
   - 前提条件: 
   - 実行手順:
   - 期待結果:

2. **シナリオ2**: [ユーザーストーリー]
   - 前提条件:
   - 実行手順:
   - 期待結果:

### X.8 テストデータ管理

#### X.8.1 フィクスチャ生成

```go
// このサービス用のテストデータ生成
func NewTestFixture() *ServiceSpecificFixture {
    // ...
}
```

#### X.8.2 シードデータ

```sql
-- 開発/テスト環境用のシードデータ
INSERT INTO ...
```

### X.9 CI/CD固有の設定

```yaml
# このサービス固有のCI設定
service-specific-tests:
  # 特殊な環境変数
  # 必要なサービス
  # タイムアウト設定
```

### X.10 テスト実行マトリクス

| テストタイプ | 実行タイミング | 実行時間目標 | 必須/任意 |
|------------|--------------|-------------|----------|
| Unit Tests | Every commit | < 1min | 必須 |
| Integration | Every PR | < 5min | 必須 |
| E2E | Before merge | < 10min | 必須 |
| Performance | Nightly | < 30min | 任意 |
| Security | Weekly | < 1hr | 任意 |