# セキュリティ実装チェックリスト

## サービス情報
- **サービス名**: avion-[service-name]
- **レビュー日**: YYYY-MM-DD
- **レビュアー**: 
- **実装者**: 

## 1. 認証・認可

### JWT検証
- [ ] すべてのエンドポイントでJWT検証を実装
- [ ] JWT署名の検証
- [ ] トークンの有効期限チェック
- [ ] リフレッシュトークンのローテーション実装
- [ ] 無効化されたトークンのブラックリスト確認

### アクセス制御
- [ ] ロールベースアクセス制御（RBAC）の実装
- [ ] リソースレベルの権限チェック
- [ ] 最小権限の原則の適用
- [ ] 管理者機能の適切な保護

## 2. 入力検証とサニタイゼーション

### 入力検証
- [ ] すべての入力パラメータの型検証
- [ ] 文字列長の制限チェック
- [ ] 数値範囲の検証
- [ ] 正規表現による形式検証
- [ ] ファイルアップロードのサイズ制限

### SQLインジェクション対策
- [ ] プリペアドステートメントの使用
```go
// 正しい実装例
query := `SELECT * FROM users WHERE id = $1`
rows, err := db.Query(query, userID)
```
- [ ] ORMの適切な使用
- [ ] 動的クエリ生成の回避
- [ ] 入力値のエスケープ処理

### XSS対策
- [ ] HTMLエンコーディングの実装
- [ ] Content Security Policy (CSP) ヘッダーの設定
- [ ] JavaScriptコンテキストでの適切なエスケープ
- [ ] JSONレスポンスの Content-Type 設定

### CSRF対策
- [ ] CSRFトークンの生成と検証
- [ ] SameSite Cookieの設定
- [ ] Refererヘッダーの検証
- [ ] カスタムヘッダーによる保護

## 3. データ保護

### 暗号化
- [ ] 機密データの暗号化（保存時）
- [ ] TLS/HTTPSによる通信の暗号化
- [ ] パスワードのハッシュ化（bcrypt/argon2）
- [ ] 暗号鍵の安全な管理

### データマスキング
- [ ] ログ出力時の機密情報マスキング
- [ ] エラーメッセージの適切な処理
- [ ] デバッグ情報の本番環境での無効化

## 4. エラーハンドリング

### エラー処理
- [ ] 詳細なエラー情報の隠蔽
- [ ] 一貫性のあるエラーレスポンス形式
- [ ] スタックトレースの非表示化
- [ ] カスタムエラーページの実装

### ログ記録
- [ ] セキュリティイベントのログ記録
- [ ] 失敗した認証試行の記録
- [ ] 異常なアクセスパターンの検出
- [ ] ログインジェクション対策

## 5. セッション管理

### セッションセキュリティ
- [ ] セキュアなセッションID生成
- [ ] セッションタイムアウトの実装
- [ ] セッション固定攻撃対策
- [ ] ログアウト時のセッション完全削除

### Cookie設定
- [ ] Secure フラグの設定
- [ ] HttpOnly フラグの設定
- [ ] SameSite 属性の設定
- [ ] 適切な有効期限の設定

## 6. APIセキュリティ

### レート制限
- [ ] APIレート制限の実装
- [ ] ユーザー別のレート制限
- [ ] DDoS対策の実装
- [ ] 適切なエラーレスポンス

### APIキー管理
- [ ] APIキーの安全な生成
- [ ] キーのローテーション機能
- [ ] キーの無効化機能
- [ ] 使用状況の監視

## 7. インフラストラクチャセキュリティ

### 環境変数
- [ ] 機密情報の環境変数管理
- [ ] シークレット管理ツールの使用
- [ ] ハードコーディングの排除
- [ ] 設定ファイルの暗号化

### コンテナセキュリティ
- [ ] 最小権限でのコンテナ実行
- [ ] ベースイメージの定期更新
- [ ] 不要なパッケージの削除
- [ ] セキュリティスキャンの実施

## 8. 監視とアラート

### セキュリティ監視
- [ ] 異常なトラフィックの検出
- [ ] 不正アクセスの監視
- [ ] ログの定期的な分析
- [ ] セキュリティメトリクスの収集

### インシデント対応
- [ ] インシデント対応手順の文書化
- [ ] アラート通知の設定
- [ ] バックアップとリカバリ手順
- [ ] セキュリティパッチの適用プロセス

## 9. コンプライアンス

### 規制要件
- [ ] GDPR要件の遵守
- [ ] データ保持ポリシーの実装
- [ ] ユーザー同意管理
- [ ] データ削除機能の実装

### セキュリティテスト
- [ ] 単体テストでのセキュリティ検証
- [ ] 統合テストでの認証・認可テスト
- [ ] ペネトレーションテストの実施
- [ ] 脆弱性スキャンの定期実行

## 10. ドキュメント

### セキュリティドキュメント
- [ ] セキュリティ設計書の作成
- [ ] 脅威モデリングの実施
- [ ] セキュリティ運用手順書
- [ ] インシデント対応計画

### トレーニング
- [ ] 開発者向けセキュリティトレーニング
- [ ] セキュアコーディング規約の周知
- [ ] 定期的なセキュリティレビュー
- [ ] ベストプラクティスの共有

## 承認

### レビュー結果
- [ ] すべてのチェック項目を確認済み
- [ ] 未対応項目のリスク評価完了
- [ ] 改善計画の策定完了
- [ ] セキュリティチームの承認取得

**セキュリティレビュアー署名**: _______________
**日付**: _______________

**技術リード承認**: _______________
**日付**: _______________

## 備考
_追加のセキュリティ考慮事項や特記事項を記載_

---

**注意事項**:
- このチェックリストは最低限のセキュリティ要件です
- サービスの特性に応じて追加の対策が必要な場合があります
- 定期的にチェックリストを見直し、最新の脅威に対応してください